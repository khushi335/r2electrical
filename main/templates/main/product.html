{% extends "base.html" %}
{% load static %}
{% block content %}

<style>
/* ================= PRODUCTS ================= */
.product-wrapper {
    background: #f5f7fa;
    padding: 60px 20px;
    font-family: 'Poppins', Arial, sans-serif;
}

.product-title {
    text-align: center;
    font-size: 36px;
    font-weight: 700;
    color: #0b2c4d;
    margin-bottom: 50px;
}

.product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 25px;
    max-width: 1200px;
    margin: auto;
}

.product-card {
    background: #fff;
    border-radius: 14px;
    overflow: hidden;
    box-shadow: 0 10px 25px rgba(0,0,0,0.08);
    transition: 0.35s ease;
    cursor: pointer;
}

.product-card:hover {
    transform: translateY(-6px);
}

.product-img {
    width: 100%;
    height: 260px;
    object-fit: cover;
}

/* ================= LIGHTBOX ================= */
.lightbox {
    position: fixed;
    left: 0;
    right: 0;
    top: 80px;                 /* BELOW NAVBAR */
    bottom: 0;
    background: rgba(0,0,0,0.9);
    z-index: 9999;
    opacity: 0;
    pointer-events: none;
    transition: 0.3s;
}

.lightbox.active {
    opacity: 1;
    pointer-events: auto;
}

/* ✅ MORE TOP SPACE, LESS BOTTOM SPACE */
.lightbox-inner {
    height: 100%;
    padding-top: 120px;        /* ⬆️ MORE SPACE ON TOP */
    padding-bottom: 40px;     /* ⬇️ LESS SPACE AT BOTTOM */
    display: flex;
    align-items: center;
    justify-content: center;
}

/* image wrapper */
.lightbox-img-wrapper {
    position: relative;
    max-width: 90%;
    max-height: 100%;
}

/* image */
.lightbox-img {
    max-width: 100%;
    max-height: calc(100vh - 240px);
    transform-origin: center center;
    transition: transform 0.3s ease;
    touch-action: none;
}

/* close inside image */
.lightbox-close {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(0,0,0,0.6);
    color: #fff;
    font-size: 22px;
    width: 36px;
    height: 36px;
    line-height: 36px;
    text-align: center;
    border-radius: 50%;
    cursor: pointer;
    z-index: 2;
}

/* arrows */
.nav-btn {
    position: fixed;
    top: calc(50% + 40px);
    font-size: 40px;
    color: #fff;
    cursor: pointer;
    user-select: none;
}

.prev { left: 30px; }
.next { right: 30px; }

@media(max-width:600px){
    .product-title { font-size: 28px; }
    .lightbox { top: 65px; }
    .lightbox-inner {
        padding-top: 100px;
        padding-bottom: 30px;
    }
}
</style>

<div class="product-wrapper">
    <div class="product-title">Our Products</div>

    <div class="product-grid">
        <div class="product-card"><img src="{% static 'img/air_con_system.jpg' %}" class="product-img zoomable"></div>
        <div class="product-card"><img src="{% static 'img/gpo.jpg' %}" class="product-img zoomable"></div>
        <div class="product-card"><img src="{% static 'img/oven.jpeg' %}" class="product-img zoomable"></div>
        <!--<div class="product-card"><img src="{% static 'img/fan_aus.png' %}" class="product-img zoomable"></div>-->
        <div class="product-card"><img src="{% static 'img/Rangehoods-collection.jpeg' %}" class="product-img zoomable"></div>
        <!--<div class="product-card"><img src="{% static 'img/smoke-alarm-install.jpeg' %}" class="product-img zoomable"></div>-->
        <div class="product-card"><img src="{% static 'img/mrsparky-electrician-sydney-blog-smoke-alarm-scaled.jpeg' %}" class="product-img zoomable"></div>
        <div class="product-card"><img src="{% static 'img/downlight.jpg' %}" class="product-img zoomable"></div>
        <div class="product-card"><img src="{% static 'img/security_lights.jpg' %}" class="product-img zoomable"></div>
        <!--<div class="product-card"><img src="{% static 'img/PURLMATE3650.jpg' %}" class="product-img zoomable"></div>-->
        <div class="product-card"><img src="{% static 'img/invicta.jpeg' %}" class="product-img zoomable"></div>
        <div class="product-card"><img src="{% static 'img/hager_meter_board.jpg' %}" class="product-img zoomable"></div>
        <div class="product-card"><img src="{% static 'img/commercial-hot-water.jpg' %}" class="product-img zoomable"></div>
        <div class="product-card"><img src="{% static 'img/downlight_image.jpeg' %}" class="product-img zoomable"></div>
        <div class="product-card"><img src="{% static 'img/security-light.jpg' %}" class="product-img zoomable"></div>
        <div class="product-card"><img src="{% static 'img/induction_cooktop.jpeg' %}" class="product-img zoomable"></div>
        <div class="product-card"><img src="{% static 'img/claro-whisper-ac-modern-bedroom-fan.jpeg' %}" class="product-img zoomable"></div>
        <div class="product-card"><img src="{% static 'img/Everhot-250L-Stainless-Steel-Electric-Hot-Water-System.jpg' %}" class="product-img zoomable"></div>
        <div class="product-card"><img src="{% static 'img/Web-12in-PDL-Cover-page-scaled-1-1536x1536.jpg' %}" class="product-img zoomable"></div>
    </div>
</div>

<!-- LIGHTBOX -->
<div class="lightbox" id="lightbox">
    <div class="lightbox-inner">
        <span class="nav-btn prev" id="prev">&#10094;</span>

        <div class="lightbox-img-wrapper">
            <span class="lightbox-close" id="close">&times;</span>
            <img id="lightboxImg" class="lightbox-img">
        </div>

        <span class="nav-btn next" id="next">&#10095;</span>
    </div>
</div>

<script>
const images = document.querySelectorAll(".zoomable");
const lightbox = document.getElementById("lightbox");
const lbImg = document.getElementById("lightboxImg");

let index = 0;
let scale = 1;
let lastTap = 0;
let startDist = 0;

/* OPEN */
images.forEach((img,i)=>{
    img.onclick = ()=>{
        index = i;
        lightbox.classList.add("active");
        lbImg.src = images[index].src;
        scale = 1;
        applyZoom();
    };
});

/* CLOSE */
document.getElementById("close").onclick = ()=> lightbox.classList.remove("active");

/* NAV */
document.getElementById("next").onclick = ()=> changeImg(1);
document.getElementById("prev").onclick = ()=> changeImg(-1);

function changeImg(dir){
    index = (index + dir + images.length) % images.length;
    lbImg.src = images[index].src;
    scale = 1;
    applyZoom();
}

/* ZOOM */
function applyZoom(){
    lbImg.style.transform = `scale(${scale})`;
}

/* WHEEL */
lbImg.addEventListener("wheel",e=>{
    e.preventDefault();
    scale += e.deltaY * -0.001;
    scale = Math.min(Math.max(1, scale), 3);
    applyZoom();
});

/* DOUBLE CLICK */
lbImg.addEventListener("dblclick",()=>{
    scale = scale === 1 ? 2 : 1;
    applyZoom();
});

/* DOUBLE TAP */
lbImg.addEventListener("touchend",e=>{
    const now = Date.now();
    if(now - lastTap < 300){
        scale = scale === 1 ? 2 : 1;
        applyZoom();
    }
    lastTap = now;
});

/* PINCH */
lbImg.addEventListener("touchstart",e=>{
    if(e.touches.length === 2){
        startDist = getDist(e.touches[0], e.touches[1]);
    }
});

lbImg.addEventListener("touchmove",e=>{
    if(e.touches.length === 2){
        e.preventDefault();
        let newDist = getDist(e.touches[0], e.touches[1]);
        scale += (newDist - startDist) * 0.005;
        scale = Math.min(Math.max(1, scale), 3);
        startDist = newDist;
        applyZoom();
    }
});

/* SWIPE */
let startX = 0;
lbImg.addEventListener("touchstart",e=> startX = e.touches[0].clientX);
lbImg.addEventListener("touchend",e=>{
    let endX = e.changedTouches[0].clientX;
    if(startX - endX > 60) changeImg(1);
    if(endX - startX > 60) changeImg(-1);
});

function getDist(a,b){
    return Math.hypot(b.pageX - a.pageX, b.pageY - a.pageY);
}
</script>

{% endblock %}
